# Production Readiness Validation Configuration
# This file defines thresholds, timeouts, and requirements for validation tests

# Validation Timeouts (in seconds)
timeouts:
  end_to_end_workflow: 300  # 5 minutes
  api_health_check: 5
  api_endpoint: 10
  websocket_connection: 30
  orchestration_test: 60
  performance_benchmark: 600  # 10 minutes
  aws_resource_check: 30
  database_query: 5
  security_scan: 300  # 5 minutes

# Performance Thresholds
performance:
  # API Response Times (in milliseconds)
  api_health_check_max_ms: 100
  api_status_query_max_ms: 200
  api_research_request_max_ms: 2000
  
  # Workflow Completion Times (in seconds)
  single_request_p90_max_seconds: 180  # 3 minutes for 90% of requests
  workflow_max_seconds: 300  # 5 minutes absolute max
  
  # Resource Usage Limits
  memory_per_session_max_gb: 2.0
  cpu_utilization_avg_max_percent: 70
  
  # Database Performance (in milliseconds)
  session_lookup_max_ms: 50
  
  # Concurrent Request Handling
  concurrent_sessions_min: 10  # Must handle at least 10 simultaneous sessions

# Document Quality Thresholds
document_quality:
  min_word_count: 500
  min_source_count: 3
  required_sections:
    - introduction
    - analysis
    - synthesis
    - conclusion

# Required Environment Variables
required_environment_variables:
  # AWS Configuration
  - AWS_REGION
  - AWS_ACCESS_KEY_ID  # Optional if using IAM roles
  - AWS_SECRET_ACCESS_KEY  # Optional if using IAM roles
  
  # Bedrock Configuration
  - BEDROCK_MODEL_ID
  
  # Database Configuration
  - DATABASE_URL
  - DATABASE_POOL_SIZE
  
  # API Configuration
  - API_HOST
  - API_PORT
  - API_SECRET_KEY
  
  # Authentication
  - JWT_SECRET_KEY
  - JWT_ALGORITHM
  
  # Redis Configuration (for session management)
  - REDIS_URL
  
  # Logging
  - LOG_LEVEL
  
  # Environment
  - ENVIRONMENT  # dev, staging, production

# Optional Environment Variables (warnings if missing)
optional_environment_variables:
  - SENTRY_DSN
  - DATADOG_API_KEY
  - SLACK_WEBHOOK_URL
  - NEW_RELIC_LICENSE_KEY

# Required Documentation Files
required_documentation:
  api_reference:
    path: docs/api_reference.md
    required_sections:
      - Authentication
      - Endpoints
      - Request/Response Examples
      - Error Codes
  
  deployment_guide:
    path: docs/deployment_guide.md
    required_sections:
      - Docker Deployment
      - AWS Deployment
      - Environment Variables
      - Database Setup
  
  user_guide:
    path: docs/user_guide.md
    required_sections:
      - Getting Started
      - Example Queries
      - Expected Outputs
      - Troubleshooting
  
  architecture:
    path: docs/architecture.md
    required_sections:
      - System Overview
      - Component Diagrams
      - Data Flow
      - Technology Stack
  
  troubleshooting:
    path: docs/troubleshooting.md
    required_sections:
      - Common Errors
      - Debugging Steps
      - Performance Issues
      - Contact Information

# AWS Resource Requirements
aws_resources:
  # IAM Roles
  required_iam_roles:
    - name: AgentScrivenerLambdaExecutionRole
      required_policies:
        - AWSLambdaBasicExecutionRole
        - BedrockFullAccess
        - CloudWatchLogsFullAccess
        - SecretsManagerReadWrite
    
    - name: AgentScrivenerECSTaskRole
      required_policies:
        - AmazonECSTaskExecutionRolePolicy
        - BedrockFullAccess
        - CloudWatchLogsFullAccess
        - SecretsManagerReadWrite
  
  # VPC Configuration
  vpc:
    required: true
    min_subnets: 2
    required_subnet_types:
      - public
      - private
  
  # CloudWatch
  cloudwatch:
    required_log_groups:
      - /aws/agent-scrivener/api
      - /aws/agent-scrivener/orchestrator
      - /aws/agent-scrivener/agents
    
    required_metrics:
      - session_count
      - success_rate
      - error_rate
      - request_latency
    
    required_alarms:
      - name: HighErrorRate
        threshold: 5  # percent
        evaluation_periods: 2
      - name: HighLatency
        threshold: 300  # seconds (5 minutes)
        evaluation_periods: 2
      - name: ServiceUnavailable
        threshold: 1  # any unavailability
        evaluation_periods: 1
  
  # S3 Buckets
  required_s3_buckets:
    - name: agent-scrivener-documents
      versioning: true
      lifecycle_policy: true
      encryption: true
    
    - name: agent-scrivener-logs
      versioning: false
      lifecycle_policy: true
      encryption: true
  
  # Secrets Manager
  required_secrets:
    - agent-scrivener/api-keys
    - agent-scrivener/database-credentials
    - agent-scrivener/jwt-secret
  
  # Bedrock
  bedrock:
    required_models:
      - anthropic.claude-3-sonnet-20240229
      - anthropic.claude-3-haiku-20240307
    required_regions:
      - us-east-1
      - us-west-2

# Agent Orchestration Requirements
orchestration:
  required_agents:
    - research_agent
    - analysis_agent
    - synthesis_agent
    - quality_agent
  
  retry_policy:
    max_attempts: 3
    backoff_multiplier: 2
    initial_delay_seconds: 1
  
  session_isolation:
    test_concurrent_sessions: 5
    max_cross_session_data_leakage: 0

# Security Requirements
security:
  # TLS Configuration
  tls:
    min_version: "1.2"
    required_for_external: true
  
  # Authentication
  authentication:
    jwt_required: true
    jwt_expiration_hours: 24
    health_endpoint_public: true
  
  # Rate Limiting
  rate_limiting:
    enabled: true
    requests_per_minute_per_user: 60
    requests_per_minute_per_ip: 100
  
  # CORS
  cors:
    enabled: true
    allowed_origins:
      - https://app.agentscrivener.com
      - https://staging.agentscrivener.com
    allow_credentials: true
  
  # Input Validation
  input_validation:
    max_query_length: 1000
    sanitize_html: true
    prevent_sql_injection: true
  
  # Dependency Security
  dependency_scanning:
    enabled: true
    block_critical_vulnerabilities: true
    max_high_vulnerabilities: 0
    max_medium_vulnerabilities: 5
  
  # Audit Logging
  audit_logging:
    enabled: true
    log_authentication_attempts: true
    log_data_access: true
    log_configuration_changes: true

# Data Persistence Requirements
data_persistence:
  # Session Persistence
  session_metadata_persist_max_seconds: 1
  
  # Backup Configuration
  backup:
    enabled: true
    frequency_hours: 24
    retention_days: 30
  
  # Archival
  archival:
    enabled: true
    archive_after_days: 30
    cold_storage_class: GLACIER
  
  # Connection Resilience
  connection_resilience:
    max_retry_attempts: 5
    retry_delay_seconds: 2
    queue_operations_on_failure: true

# Validation Execution Settings
validation_execution:
  # Parallel Execution
  parallel_validators: true
  max_parallel_validators: 5
  
  # Failure Handling
  continue_on_warning: true
  continue_on_non_critical_failure: true
  block_deployment_on_critical_failure: true
  
  # Reporting
  generate_summary_report: true
  generate_detailed_report: true
  generate_remediation_guide: true
  report_formats:
    - markdown
    - json
    - html
  
  # Validation Categories
  critical_validators:
    - end_to_end
    - api_endpoints
    - security
    - data_persistence
  
  optional_validators:
    - documentation
    - performance_benchmarking
  
  # Skip Flags
  allow_skip_aws: true
  allow_skip_performance: true
  allow_skip_documentation: true

# Test Data Configuration
test_data:
  # Test Research Queries
  test_queries:
    - "What are the latest developments in quantum computing?"
    - "Explain the impact of climate change on ocean ecosystems"
    - "What are the key principles of microservices architecture?"
  
  # Mock Session IDs
  mock_session_ids:
    - test_session_001
    - test_session_002
    - test_session_003
  
  # Mock User IDs
  mock_user_ids:
    - test_user_001
    - test_user_002

# Monitoring and Alerting
monitoring:
  # Health Check Configuration
  health_check:
    interval_seconds: 30
    timeout_seconds: 5
    unhealthy_threshold: 3
  
  # Alert Delivery
  alerting:
    test_alert_delivery: true
    required_sns_topics:
      - agent-scrivener-critical-alerts
      - agent-scrivener-warning-alerts
  
  # Log Validation
  logging:
    structured_logging_required: true
    log_format: json
    sensitive_data_patterns:
      - "(?i)(api[_-]?key|apikey)"
      - "(?i)(secret|password|passwd|pwd)"
      - "(?i)(token|auth)"
      - "(?i)(credit[_-]?card|cc[_-]?number)"
      - "(?i)(ssn|social[_-]?security)"
